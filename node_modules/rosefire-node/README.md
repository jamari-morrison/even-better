# Rosefire Node SDK
 
![Node](https://img.shields.io/badge/node-v2.0.0beta-darkgreen.svg)

## Overview 

This is the node library to handle auth tokens generated by the rosefire server. You'll need this if you want to use Rose-Hulman as an authentication service.

If you use these libraries, you can either do everything server-side, or you get fetch the tokens using the client libraries, then pass the returned token to your backend and decrypt it on your server. In this case, the SECRET that you use when you [register](https://rosefire.csse.rose-hulman.edu) is whatever you want, but you'll need to use it as a key on your server.

To learn more about how Rosefire works checkout [this link](https://jwt.io/introduction/).

### A Note About Security

**IMPORTANT:** Because token verifier requires your secret, you should only verify
tokens on *trusted servers*. Never embed your Secret directly into your application and
never share your Secret with a connected client. Only your registry token is safe to share with clients.

## Usage

```bash
npm install --save git+https://ada.csse.rose-hulman.edu/rosefire/node-sdk.git#2.0.0beta
```

This is a simple express endpoint that decodes a token from Rosefire, and returns the auth data.

```node
var RosefireTokenVerifier = require('rosefire-node');

var rosefire = new RosefireTokenVerifier(SECRET);

app.post('/foobar', function (req, res) {
  var token = req.headers.authorization;
  if (!token) {
    res.status(401).json({
      error: 'Not authorized!'
    });
    return;
  }
  token = token.split(' ')[1]; 
  rosefire.verify(token, function(err, authData) {
    if (err) {
      res.status(401).json({
        error: 'Not authorized!'
      });
    } else {
      console.log(authData.username); // rockwotj
      console.log(authData.issued_at); // <Date Object of issued time> 
      console.log(authData.group); // STUDENT (Only there if options asked)
      console.log(authData.expires) // <Date Object> (Only there if options asked)
      res.json(authData);
    }
  });
};

```

